# Pulmonary nodule classification system based on Keras 2.0

The project includes 3 parts: preprocessing, training, and deployment.

The Top-level directory layout is:
```
.
├── code
│   ├── preprocess.py                    # source code for preprocessing and augmenting the training and validation data
│   ├── residual_train.py                # source code for training a 3D CNN model with residual blocks
│   ├── squeeze_train.py                 # source code for training a 3D squeeze-net model
│   └── deploy.py                        # source code for deploying the classification system on original validation data
├── data                    
│   ├── original
│   │   ├── lung-train-label_0.h5        # Original training data with label 0
│   │   ├── lung-train-label_1.h5        # Original training data with label 1
│   │   ├── lung-val-label_0.h5          # Original validation data with label 0
│   │   └── lung-val-label_1.h5          # Original validation data with label 1
│   └── preprocessed                     # Empty for now. Used to store the preprocessed data generated by running preprocess.py
├── model                    
│   ├── pretrained
│   │   ├── 7764                         
│   │   │   ├── squeeze_model.h5         # First pretrained 3D squeeze-net Keras model
│   │   │   └── train_mean.npy           # Corresponding data mean
│   │   └── 7785                         
│   │       ├── squeeze_model.h5         # Second pretrained 3D squeeze-net Keras model
│   │       └── train_mean.npy           # Corresponding data mean
│   ├── residual                         # Empty for now. Used to store the model and mean data trained by running residual_train.py
│   └── squeeze                          # Empty for now. Used to store the model and mean data trained by running squeeze_train.py
├── script
│   ├── preprocess.bat                   # Batch file for running preprocess.py
│   ├── train.bat                        # Batch file for running residual_train.py and then running squeeze_train.py
│   └── deploy.bat                       # Batch file for running deploy.py
└── FinalReport.pdf
```
### Prerequisites

1. Windows 10 operating system
2. Visual Studio 2015 Community Edition Update 3 w.
3. Anaconda (64-bit) w. Python 3.6 (Anaconda3-4.4.0)
   - A Python distro that contains NumPy, SciPy, and other scientific libraries
4. CUDA 8.0.61 (64-bit)
5. cuDNN v5.1 (Jan 20, 2017) for CUDA 8.0
6. Keras 2.0.5 with Theano 0.9.0 backend

[More details](https://github.com/philferriere/dlwin/)

After meeting up with all the prerequisites above, you MUST make sure running the following 2 commands in your cmd DOES NOT generate any error:
```
activate dlwin36
set KERAS_BACKEND=tensorflow
```

### Instructions

A step-by-step instruction telling you how to run preprocessing, training, and deploying.

1. Under root directory, go to `.\script`
2. Double click `preprocess.bat` (If you want to run unit_test for `preprocess.py`, please uncomment line 481 in `preprocess.py`)
3. Double click `train.bat` (For saving your time, the default training number of epochs for `squeeze_train.py` is 5 and for `residual_train.py` is 2. However, you can adjust it in `squeeze_train.py` and `residual_train.py` easily)
4. Double click `deploy.bat` (You should see the results both in cmd and in a separate window)

All done!